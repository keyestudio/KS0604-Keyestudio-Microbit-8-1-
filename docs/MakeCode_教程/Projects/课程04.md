### 3.2.4 电动螃蟹 

#### 3.2.4.1 简介

![Img](./media/top1.png)

使用一些乐高积木块、Microbit V2主板，舵机扩展板和乐高舵机等，来搭建一个电动螃蟹，通过Microbit V2主板上面的按钮A/B和代码编程来控制电动螃蟹向左向右爬行。

![Img](./media/bottom1.png)

#### 3.2.4.2 所需组件

![Img](./media/A4-0.png)


#### 3.2.4.3 积木搭建

![Img](./media/2top.png)

![Img](./media/A4-1.png)

![Img](./media/A4-2.png)

![Img](./media/A4-3.png)

![Img](./media/A4-4.png)

![Img](./media/A4-5.png)

![Img](./media/A4-6.png)

![Img](./media/A4-7.png)

![Img](./media/A4-8.png)

![Img](./media/A4-9.png)

![Img](./media/A4-10.png)

![Img](./media/A4-11.png)

![Img](./media/A4-12.png)

![Img](./media/A4-13.png)

![Img](./media/A4-14.png)

![Img](./media/A4-15.png)

![Img](./media/A4-16.png)

![Img](./media/A4-17.png)

![Img](./media/A4-18.png)

![Img](./media/A4-19.png)

![Img](./media/A4-20.png)

![Img](./media/A4-21.png)

![Img](./media/A4-22.png)

![Img](./media/A4-23.png)

![Img](./media/A4-24.png)

![Img](./media/A4-25.png)

![Img](./media/A4-26.png)

![Img](./media/A4-27.png)

![Img](./media/A4-28.png)

![Img](./media/A4-29.png)

![Img](./media/A4-30.png)

![Img](./media/A4-31.png)

![Img](./media/A4-32.png)

![Img](./media/A4-33.png)

![Img](./media/A4-34.png)

![Img](./media/A4-35.png)

![Img](./media/A4-36.png)

![Img](./media/A4-37.png)

![Img](./media/A4-38.png)

![Img](./media/A4-39.png)

![Img](./media/A4-40.png)

![Img](./media/A4-41.png)

![Img](./media/A4-42.png)

![Img](./media/A4-43.png)

![Img](./media/A4-44.png)

![Img](./media/A4-45.png)

![Img](./media/A4-46.png)

| 乐高舵机 | 舵机扩展板引脚(SERVO1/P1) | micro:bit V2主板引脚 |
| :-----: | :----------------------: | :--------------: |
|   棕线   |           GND           |         G         |
|   红线   |           VCC           |         V         |
|  橙黄线  |          SIG(S)         |         P1        |

![Img](./media/wiring4.jpg)


![Img](./media/2bottom.png)

#### 3.2.4.4 代码流程图

```mermaid
flowchart TD
    Start([开始]) --> OnInit1[初始化]

    OnInit1 --> OnInit2[设置SK6812 RGB LED的引脚为P0<br>设置SK6812 RGB LED亮度为30%<br>SK6812 RGB LED不亮]
    
    OnInit2 --> IdleState[空闲状态/等待事件]
    
    IdleState --> EventBtnA[按下micro:bit V2主板上面的按钮A且松开]
    IdleState --> EventBtnB[按下micro:bit V2主板上面的按钮B且松开]
    IdleState --> EventBtnAB[同时按下micro:bit V2主板上面的按钮A+B且松开]
    
    EventBtnA --> BtnAAction[1\. SK6812 RGB LED亮红色灯<br>2\. 5×5LED点阵屏显示 “高兴” 图案<br>3\. 电动螃蟹向右行走]
    BtnAAction --> IdleState
    
    EventBtnB --> BtnBAction[1\. SK6812 RGB LED亮青色灯<br>2\. 5×5LED点阵屏显示 “爱心” 图案<br>3\. 电动螃蟹向左行走]
    BtnBAction --> IdleState

    EventBtnAB --> BtnABAction[1\. SK6812 RGB LED熄灭<br>2\. 5×5LED点阵屏清屏<br>3\. 电动螃蟹停止行走]
    BtnABAction --> IdleState
```

#### 3.2.4.5 指令方块说明

1\. “on start”代码块中的代码将仅执行一次。

![Img](./media/on-start.png)

2\. 设置micro:bit V2主板上面的5×5 LED点阵屏显示图案.

![Img](./media/55LED.png)

3\. 设置SK6812 RGB LED的引脚和点亮RGB LED颗粒数.

![Img](./media/RGBLED.png)

4\. 设置SK6812 RGB LED 的亮度.

![Img](./media/RGBLED1.png)

5\. 设置SK6812 RGB LED 都不亮。

![Img](./media/RGBclear.png)

6\. 当按下（或同时按下）按钮（A、B 或A+B）并再次松开时，触发并执行代码块中的一系列动作。

![Img](./media/buttonAB.png)

7\. 设置SK6812 RGB LED点亮的颜色灯.

![Img](./media/color.png)

8\. 设置360°舵机的引脚，转动方向(顺时针/逆时针)和转动的速度(0~100%)。

![Img](./media/360Servo.png)

9\. micro:bit V2主板上面的5×5 LED点阵屏清屏

![Img](./media/5×5LEDClear.png)

#### 3.2.4.6 实验代码

![Img](./media/couj04.png)

⚠️ **<span style="color: rgb(255, 76, 65);">特别提醒：可以通过以下两种方法获取实验代码。</span>**

##### **方法一：拖动代码块编写代码**

**1. MakeCode编程环境：**

打开MakeCode编辑器在线网页版本: [https://makecode.microbit.org/#editor](https://makecode.microbit.org/#editor)

**2. 添加专属扩展库**

⚠️ **<span style="color: rgb(255, 76, 65);">特别提醒:</span>** 将链接：`https://github.com/keyestudio2019/pxt-creative-inventors-kit-master.git` 复制粘贴到页面的搜索框中。

![Img](./media/Animation-4.gif)

**3. 编写代码**

![Img](./media/dongtu-04.gif)

##### **方法二：直接下载示例代码**

**1. 下载示例代码：**

单击下载代码：[3_3_4_Electric_Crab](./Codes/3_3_4_Electric_Crab.hex)

**2. MakeCode编程环境：**

打开MakeCode编辑器在线网页版本: [https://makecode.microbit.org/#editor](https://makecode.microbit.org/#editor)

**3. 导入示例代码：**

将下载好的示例代码拖入MakeCode编辑器中。

![Img](./media/Animation-0004.gif)

![Img](./media/line1.png)

**简单说明：**

① 初始化RGB LED的引脚P0和点亮RGB LED颗粒数，RGB LED的亮度，RGB LED全不亮。

![Img](./media/cou06.png)

② 按下micro:bit V2主板上面的按钮A且松开时，电动螃蟹向右行走，同时SK6812 RGB LED亮绿灯，micro:bit V2主板上面的5×5 LED点阵屏显示图案![Img](./media/ab3.png)。

![Img](./media/cou09.png)

③ 按下micro:bit V2主板上面的按钮B且松开时，电动螃蟹向左行走，同时SK6812 RGB LED亮蓝灯，micro:bit V2主板上面的5×5 LED点阵屏显示图案![Img](./media/ab4.png)。

![Img](./media/cou12.png)

④ 同时按下micro:bit V2主板上面的按钮A+B且松开时，电动螃蟹停止，同时SK6812 RGB LED熄灭，micro:bit V2主板上面的5×5 LED点阵屏清屏。

![Img](./media/cou13.png)

#### 3.2.4.7 实验结果

![Img](./media/4top.png)

按照接线图接好线，利用micro USB数据线上电，同时还需要外接电源 (4个AAA电池安装到电池盒，且保证电源充足)。

使用在线浏览器下载示例代码，则需要将下载好的 “.hex” 文件发送到micro:bit主板上。如下两种情况：

**① 下载示例代码(WebUSB功能)**

使用 **Google Chrome** 浏览器 或  **Microsoft Edge** 浏览器，需要先进行设备配对，再将示例代码下载到micro:bit V2主板上。

![Img](./media/Animation-04.gif)

**② 下载示例代码(非WebUSB功能)**

使用其他浏览器（非Google Chrome 或 Microsoft Edge），将示例代码下载、发送到micro:bit V2主板上。

![Img](./media/Animation-004.gif)

将示例代码成功下载、发送到micro:bit V2主板之后，然后将micro USB数据线从micro:bit V2主板上拔下来。

将舵机扩展板上的左侧拨码开关拨到RGB端，右侧拨码开关拨到ON端。

![Img](./media/CBA01.png)

按下micro:bit V2主板上面的按钮A且松开时，电动螃蟹向右行走，同时SK6812 RGB LED亮绿灯，micro:bit V2主板上面的5×5 LED点阵屏显示图案![Img](./media/ab3.png)；

按下micro:bit V2主板上面的按钮B且松开时，电动螃蟹向左行走，同时SK6812 RGB LED亮蓝灯，micro:bit V2主板上面的5×5 LED点阵屏显示图案![Img](./media/ab4.png)；

同时按下micro:bit V2主板上面的按钮A+B且松开时，电动螃蟹停止行走，同时SK6812 RGB LED熄灭，micro:bit V2主板上面的5×5 LED点阵屏清屏。

![Img](./media/dongtu-004.gif)

![Img](./media/4bottom.png)
