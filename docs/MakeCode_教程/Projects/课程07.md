### 3.2.7 摩天轮

#### 3.2.7.1 简介

![Img](./media/top1.png)

使用一些乐高积木块、Microbit V2主板，舵机扩展板和1个乐高舵机等，来搭建一个声控摩天轮，通过声音和代码编程来控制摩天轮转动。

![Img](./media/bottom1.png)



#### 3.2.7.3 所需组件



#### 3.2.7.4 积木搭建

![Img](./media/2top.png)

| 乐高舵机 | 舵机扩展板引脚(SERVO1/P1) | micro:bit主板引脚 |
| :-----: | :----------------------: | :--------------: |
|   棕线   |           GND           |         G         |
|   红线   |           VCC           |         V         |
|  橙黄线  |          SIG(S)         |         P1        |

![Img](./media/wiring7.jpg)

![Img](./media/2bottom.png)

#### 3.2.7.5 代码流程图

```mermaid
flowchart TD
    Start["开始"] --> OnInit1["初始化"]

    OnInit1 --> OnInit2["设置SK6812 RGB LED的引脚为P0<br>设置SK6812 RGB LED亮度为30%<br>SK6812 RGB LED不亮"]
    
    OnInit2 --> IdleState["空闲状态(等待事件)"]
    
    IdleState --> EventBtnA["按钮A被按下"]
    IdleState --> EventBtnB["按钮B被按下"]
    
    EventBtnA --> BtnAAction["1\. SK6812 RGB LED亮多彩颜色灯<br>2\. 5×5LED点阵屏显示“高兴”图案<br>3\. 摩天轮转动"]
    BtnAAction --> IdleState
    
    EventBtnB --> BtnBAction["1\. SK6812 RGB LED熄灭<br>2\. 5×5LED点阵屏清屏<br>3\. 摩天轮停止转动"]
    BtnBAction --> IdleState
```

#### 3.2.7.6 实验代码

![Img](./media/couj07.png)

⚠️ **<span style="color: rgb(255, 76, 65);">特别提醒：可以通过以下两种方法获取实验代码。</span>**

##### **方法一：拖动代码块编写代码**

**1. MakeCode编程环境：**

打开MakeCode在线网页版本: [https://makecode.microbit.org/#editor](https://makecode.microbit.org/#editor)

**2. 添加专属扩展库**

⚠️ **<span style="color: rgb(255, 76, 65);">特别提醒:</span>** 将链接：`https://github.com/keyestudio2019/pxt-creative-inventors-kit-master.git` 复制粘贴到页面的搜索框中。

![Img](./media/Animation-4.gif)

**3. 编写代码**

![Img](./media/dongtu-07.gif)

##### **方法二：直接下载示例代码**

**1. 下载示例代码：**

单击下载代码：[3_3_7_Ferris_Wheel](./Codes/3_3_7_Ferris_Wheel.hex)

**2. MakeCode编程环境：**

打开MakeCode编辑器：[https://makecode.microbit.org/#editor](https://makecode.microbit.org/#editor)

**3. 导入示例代码：**

将下载好的示例代码拖入MakeCode编辑器。

![Img](./media/line1.png)

**简单说明：**

① 初始化OLED显示屏的像素，OLED清屏，Microbit主板上的5×5LED点阵屏显示图案![Img](./media/ab6.png)，定义两个变量temperature与humidity的初始值均为0 和 雾化模块不工作。

![Img](./media/cou23.png)

② 将XHT11温湿度传感器读取的温度值赋给于变量temperature，湿度值赋给于变量humidity。

![Img](./media/cou24.png)

③ OLED显示屏显示XHT11温湿度传感器检测到的温度和湿度。

![Img](./media/cou25.png)

④ 这是if()...else...的判断语句。

如果检测到的温度大于30℃或者湿度大于70%RH时，风扇转动2秒后停止；然后雾化模块工作，喷出水雾；起到调节环境中温湿度的效果。同时OLED显示屏还显示“Cooling/Humidifying”。

![Img](./media/cou26.png)

否则，风扇不转动，雾化模块也不启动。同时OLED显示屏还显示“Normal State”。

![Img](./media/cou27.png)

⑤ 延时500ms(即：0.5s)。

![Img](./media/cou28.png)

#### 3.2.7.7 实验结果

![Img](./media/4top.png)

按照接线图接好线，利用micro USB数据线上电，同时还需要外接电源 (4个AAA电池安装到电池盒，且保证电源充足)。

使用在线浏览器下载示例代码，则需要将下载好的 “.hex” 文件发送到micro:bit主板。

**① 下载示例代码(WebUSB功能)**

使用 **Google Chrome** 浏览器 或  **Microsoft Edge** 浏览器，将示例代码下载到micro:bit主板上：

![Img](./media/Animation-07.gif)

**② 下载示例代码(非WebUSB功能)**

使用其他浏览器（非Google Chrome 或 Microsoft Edge），将示例代码下载、发送到micro:bit主板上：

![Img](./media/Animation-007.gif)

将示例代码成功下载、发送到micro:bit主板之后，然后将micro USB数据线从micro:bit主板上拔下来。

当按下micro:bit上面的按钮A时，摩天轮开始转动，同时SK6812 RGB LED亮多彩颜色灯，micro:bit上面的5×5LED点阵屏显示“高兴”图案；

当按下micro:bit上面的按钮B时，摩天轮停止工作，同时SK6812 RGB LED熄灭，micro:bit上面的5×5LED点阵屏清屏。

![Img](./media/dongtu-7.gif)

![Img](./media/4bottom.png)
